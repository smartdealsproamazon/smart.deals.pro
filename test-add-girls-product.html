<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Add Girls Product - SmartDeals Pro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .success { background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .error { background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .info { background: #d1ecf1; padding: 15px; border-radius: 5px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test Add Girls Fashion Product</h1>
    <p>This page allows you to add a test girls fashion product directly to Firebase to test the category filtering.</p>
    
    <div id="status"></div>

    <form id="testProductForm">
      <div class="form-group">
        <label for="title">Product Title:</label>
        <input type="text" id="title" value="Test Girls Fashion Dress" required>
      </div>

      <div class="form-group">
        <label for="price">Price:</label>
        <input type="number" id="price" value="29.99" step="0.01" required>
      </div>

      <div class="form-group">
        <label for="originalPrice">Original Price:</label>
        <input type="number" id="originalPrice" value="39.99" step="0.01">
      </div>

      <div class="form-group">
        <label for="category">Category:</label>
        <select id="category" required>
          <option value="">Select Category</option>
          <option value="girls" selected>girls</option>
          <option value="girls-fashion">girls-fashion</option>
          <option value="Girls Fashion">Girls Fashion</option>
        </select>
      </div>

      <div class="form-group">
        <label for="description">Description:</label>
        <textarea id="description" rows="3">Beautiful test dress for girls fashion category testing</textarea>
      </div>

      <div class="form-group">
        <label for="link">Product Link:</label>
        <input type="url" id="link" value="https://example.com/test-product">
      </div>

      <div class="form-group">
        <label for="image">Image URL:</label>
        <input type="url" id="image" value="https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?w=300&h=300&fit=crop">
      </div>

      <button type="submit">Add Test Product</button>
      <button type="button" onclick="checkGirlsProducts()">Check Girls Products</button>
      <button type="button" onclick="openGirlsFashionPage()">Open Girls Fashion Page</button>
    </form>

    <div id="results"></div>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBJqBEWDdBlfv5xAjgcvqput1KC1NzKvlU",
      authDomain: "smart-deals-pro.firebaseapp.com",
      projectId: "smart-deals-pro",
      storageBucket: "smart-deals-pro.firebasestorage.app",
      messagingSenderId: "680016915696",
      appId: "1:680016915696:web:4b3721313ea0e2e3342635",
      measurementId: "G-HV5N0LQJTG"
    };

    // Initialize Firebase
    let db;
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      db = firebase.firestore();
      console.log('Firebase initialized successfully');
    } catch (error) {
      console.error('Firebase initialization failed:', error);
      showStatus('Firebase initialization failed: ' + error.message, 'error');
    }

    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
    }

    function showResults(html) {
      document.getElementById('results').innerHTML = html;
    }

    // Add test product
    document.getElementById('testProductForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const productData = {
        title: document.getElementById('title').value,
        name: document.getElementById('title').value, // Duplicate for compatibility
        price: parseFloat(document.getElementById('price').value),
        originalPrice: parseFloat(document.getElementById('originalPrice').value || document.getElementById('price').value),
        category: document.getElementById('category').value,
        description: document.getElementById('description').value,
        link: document.getElementById('link').value,
        image: document.getElementById('image').value,
        imageData: document.getElementById('image').value, // Duplicate for compatibility
        rating: 4.5,
        reviews: Math.floor(Math.random() * 20) + 5,
        discount: Math.round((1 - (parseFloat(document.getElementById('price').value) / parseFloat(document.getElementById('originalPrice').value || document.getElementById('price').value))) * 100),
        featured: true,
        createdAt: new Date().toISOString(),
        submittedBy: 'test-system',
        status: 'approved'
      };

      showStatus('Adding test product...', 'info');
      console.log('Adding product with data:', productData);

      db.collection('products').add(productData)
        .then((docRef) => {
          showStatus(`‚úÖ Test product added successfully! Document ID: ${docRef.id}`, 'success');
          console.log('Product added with ID:', docRef.id);
          
          // Wait a moment then check girls products
          setTimeout(() => {
            checkGirlsProducts();
          }, 2000);
        })
        .catch((error) => {
          showStatus(`‚ùå Error adding product: ${error.message}`, 'error');
          console.error('Error adding product:', error);
        });
    });

    // Check girls products
    function checkGirlsProducts() {
      showStatus('Checking girls products...', 'info');
      
      db.collection('products').where('category', '==', 'girls').get()
        .then((snapshot) => {
          console.log(`Found ${snapshot.size} girls products`);
          
          let html = `<div class="info"><h3>üëß Girls Products Found: ${snapshot.size}</h3>`;
          
          if (snapshot.size === 0) {
            html += '<p>‚ùå No products found with category = "girls"</p>';
          } else {
            html += '<ul>';
            snapshot.docs.forEach(doc => {
              const data = doc.data();
              html += `
                <li>
                  <strong>${data.title || data.name}</strong><br>
                  Category: "${data.category}"<br>
                  Price: $${data.price}<br>
                  ID: ${doc.id}<br>
                  Created: ${data.createdAt ? new Date(data.createdAt).toLocaleString() : 'Unknown'}
                </li>
              `;
            });
            html += '</ul>';
          }
          
          html += '</div>';
          showResults(html);
          
          if (snapshot.size > 0) {
            showStatus(`‚úÖ Found ${snapshot.size} girls products! They should appear on the girls fashion page.`, 'success');
          } else {
            showStatus('‚ùå No girls products found. Try adding a test product first.', 'error');
          }
        })
        .catch((error) => {
          showStatus(`‚ùå Error checking girls products: ${error.message}`, 'error');
          console.error('Error checking products:', error);
        });
    }

    function openGirlsFashionPage() {
      window.open('girls-fashion.html', '_blank');
    }

    // Auto-check products on page load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        checkGirlsProducts();
      }, 1000);
    });
  </script>
</body>
</html>