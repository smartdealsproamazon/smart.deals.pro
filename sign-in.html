<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign In - SmartDeals Pro</title>
  <meta name="description" content="Sign in to your SmartDeals Pro account to access exclusive deals and manage your preferences.">
  <link rel="canonical" href="https://smartdealsproamazon.github.io/smart.deals.pro/sign-in.html">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- Enhanced Favicon Implementation - Updated with New Logo -->
  <link rel="icon" type="image/x-icon" href="favicon.ico" sizes="16x16 32x32">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512x512.png">
  <link rel="icon" type="image/svg+xml" href="logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
  <link rel="apple-touch-icon" sizes="152x152" href="logo.png">
  <link rel="apple-touch-icon" sizes="144x144" href="logo.png">
  <link rel="apple-touch-icon" sizes="120x120" href="logo.png">
  <link rel="apple-touch-icon" sizes="114x114" href="logo.png">
  <link rel="apple-touch-icon" sizes="76x76" href="logo.png">
  <link rel="apple-touch-icon" sizes="72x72" href="logo.png">
  <link rel="apple-touch-icon" sizes="60x60" href="logo.png">
  <link rel="apple-touch-icon" sizes="57x57" href="logo.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="msapplication-TileColor" content="#3b82f6">
  <meta name="msapplication-TileImage" content="logo.png">
  <meta name="theme-color" content="#3b82f6">
  
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-73WLXY20G3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-73WLXY20G3');
  </script>
  <style>
    .auth-container {
      max-width: 450px;
      margin: 80px auto;
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .auth-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .auth-header h2 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .auth-header p {
      color: #666;
      font-size: 16px;
    }
    .auth-tabs {
      display: flex;
      margin-bottom: 30px;
      border-bottom: 2px solid #f0f0f0;
    }
    .auth-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      background: none;
      border: none;
      font-size: 16px;
      color: #666;
      transition: all 0.3s;
    }
    .auth-tab.active {
      color: #f0c14b;
      border-bottom: 2px solid #f0c14b;
    }
    .auth-form {
      display: none;
    }
    .auth-form.active {
      display: block;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 500;
    }
    .form-group input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    .form-group input:focus {
      outline: none;
      border-color: #f0c14b;
    }
    .form-group .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-group .checkbox-group input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .auth-button {
      width: 100%;
      background: #f0c14b;
      color: #333;
      padding: 15px;
      border: 2px solid #a88734;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .auth-button:hover {
      background: #e6b800;
      transform: translateY(-2px);
    }
    .auth-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .error-message {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .success-message {
      color: #27ae60;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .back-home {
      text-align: center;
      margin-top: 30px;
    }
    .back-home a {
      color: #666;
      text-decoration: none;
      font-size: 14px;
    }
    .back-home a:hover {
      color: #f0c14b;
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-header">
      <h2>Welcome to SmartDeals Pro</h2>
      <p>Create your account to get personalized deals and notifications</p>
    </div>

    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('signin')">Sign In</button>
      <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
    </div>

    <!-- Sign In Form -->
    <form id="signinForm" class="auth-form active">
      <div class="form-group">
        <label for="signinEmail">Email Address</label>
        <input type="email" id="signinEmail" required>
        <div class="error-message" id="signinEmailError"></div>
      </div>
      <div class="form-group">
        <label for="signinPassword">Password</label>
        <input type="password" id="signinPassword" required>
        <div class="error-message" id="signinPasswordError"></div>
      </div>
      <button type="submit" class="auth-button">Sign In</button>
      <div class="error-message" id="signinError"></div>
      <div class="success-message" id="signinSuccess"></div>
    </form>

    <!-- Sign Up Form -->
    <form id="signupForm" class="auth-form">
      <div class="form-group">
        <label for="signupName">Full Name</label>
        <input type="text" id="signupName" required>
        <div class="error-message" id="signupNameError"></div>
      </div>
      <div class="form-group">
        <label for="signupEmail">Email Address</label>
        <input type="email" id="signupEmail" required>
        <div class="error-message" id="signupEmailError"></div>
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" required minlength="8">
        <div class="error-message" id="signupPasswordError"></div>
      </div>
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" id="confirmPassword" required>
        <div class="error-message" id="confirmPasswordError"></div>
      </div>
      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="notificationConsent" checked>
          <label for="notificationConsent">I want to receive daily notifications about new products and deals</label>
        </div>
      </div>
      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="termsConsent" required>
          <label for="termsConsent">I agree to the Terms of Service and Privacy Policy</label>
        </div>
      </div>
      <button type="submit" class="auth-button">Create Account</button>
      <div class="error-message" id="signupError"></div>
      <div class="success-message" id="signupSuccess"></div>
    </form>

    <div class="back-home">
      <a href="index.html"><i class="fas fa-home"></i> Back to Home</a>
    </div>
  </div>

  <script>
    // User Authentication System with Cross-Device Support
    class UserAuth {
      constructor() {
        this.init();
      }

      init() {
        this.setupEventListeners();
        this.checkExistingSession();
      }

      setupEventListeners() {
        document.getElementById('signinForm').addEventListener('submit', (e) => this.handleSignIn(e));
        document.getElementById('signupForm').addEventListener('submit', (e) => this.handleSignUp(e));
      }

      // Check for existing session on page load
      checkExistingSession() {
        const sessionData = this.getSessionData();
        if (sessionData && sessionData.user && sessionData.expiresAt) {
          const now = new Date().getTime();
          if (now < sessionData.expiresAt) {
            // User is already logged in, redirect
            console.log('User already logged in, redirecting...');
            this.showSuccess('signinSuccess', 'Already logged in! Redirecting...');
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 1000);
          }
        }
      }

      // Get session data
      getSessionData() {
        try {
          const sessionKey = 'smartdeals_session';
          const localData = localStorage.getItem(sessionKey);
          if (localData) {
            return JSON.parse(localData);
          }
          return null;
        } catch (e) {
          console.error('Error getting session data:', e);
          return null;
        }
      }

      // Create session for cross-device support
      createSession(user) {
        const sessionData = {
          user: user,
          sessionId: this.generateSessionId(),
          createdAt: new Date().getTime(),
          expiresAt: new Date().getTime() + (30 * 24 * 60 * 60 * 1000), // 30 days
          deviceInfo: this.getDeviceInfo()
        };

        // Store in multiple places for cross-device support
        localStorage.setItem('smartdeals_session', JSON.stringify(sessionData));
        localStorage.setItem('smartdeals_currentUser', JSON.stringify(user));
        sessionStorage.setItem('smartdeals_session', JSON.stringify(sessionData));

        console.log('Session created for user:', user.email);
      }

      // Generate unique session ID
      generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }

      // Get device information
      getDeviceInfo() {
        return {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screenSize: `${screen.width}x${screen.height}`,
          timestamp: new Date().toISOString()
        };
      }

      async handleSignIn(e) {
        e.preventDefault();
        this.clearMessages();

        const email = document.getElementById('signinEmail').value;
        const password = document.getElementById('signinPassword').value;

        if (!this.validateEmail(email)) {
          this.showError('signinEmailError', 'Please enter a valid email address');
          return;
        }

        if (password.length < 8) {
          this.showError('signinPasswordError', 'Password must be at least 8 characters');
          return;
        }

        // Check if user exists
        const users = JSON.parse(localStorage.getItem('smartdeals_users') || '[]');
        const user = users.find(u => u.email === email && u.password === password);

        if (!user) {
          this.showError('signinError', 'Invalid email or password');
          return;
        }

        // Update last login
        user.lastLogin = new Date().toISOString();
        localStorage.setItem('smartdeals_users', JSON.stringify(users));

        // Create cross-device session
        this.createSession(user);

        this.showSuccess('signinSuccess', 'Sign in successful! Redirecting...');
        
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
      }

      async handleSignUp(e) {
        e.preventDefault();
        this.clearMessages();

        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const notificationConsent = document.getElementById('notificationConsent').checked;
        const termsConsent = document.getElementById('termsConsent').checked;

        // Validation
        if (name.length < 2) {
          this.showError('signupNameError', 'Name must be at least 2 characters');
          return;
        }

        if (!this.validateEmail(email)) {
          this.showError('signupEmailError', 'Please enter a valid email address');
          return;
        }

        if (password.length < 8) {
          this.showError('signupPasswordError', 'Password must be at least 8 characters');
          return;
        }

        if (password !== confirmPassword) {
          this.showError('confirmPasswordError', 'Passwords do not match');
          return;
        }

        if (!termsConsent) {
          this.showError('signupError', 'Please agree to the Terms of Service');
          return;
        }

        // Check if user already exists
        const users = JSON.parse(localStorage.getItem('smartdeals_users') || '[]');
        if (users.find(u => u.email === email)) {
          this.showError('signupEmailError', 'An account with this email already exists');
          return;
        }

        // Create new user
        const newUser = {
          id: Date.now().toString(),
          name,
          email,
          password,
          notificationConsent,
          joinDate: new Date().toISOString(),
          lastLogin: new Date().toISOString(),
          lastNotification: null
        };

        users.push(newUser);
        localStorage.setItem('smartdeals_users', JSON.stringify(users));

        // Create cross-device session
        this.createSession(newUser);

        this.showSuccess('signupSuccess', 'Account created successfully! Redirecting...');
        
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
      }

      validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
      }

      showSuccess(elementId, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
      }

      clearMessages() {
        const messages = document.querySelectorAll('.error-message, .success-message');
        messages.forEach(msg => {
          msg.style.display = 'none';
          msg.textContent = '';
        });
      }
    }

    // Tab switching functionality
    function switchTab(tabName) {
      // Remove active class from all tabs and forms
      document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));

      // Add active class to selected tab and form
      document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
      document.getElementById(tabName + 'Form').classList.add('active');

      // Clear any messages
      const messages = document.querySelectorAll('.error-message, .success-message');
      messages.forEach(msg => {
        msg.style.display = 'none';
        msg.textContent = '';
      });
    }

    // Initialize authentication system
    const userAuth = new UserAuth();
  </script>
  <script src="cloud-sync.js"></script>
</body>
</html>
