<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Marketplace - SmartDeals Pro</title>
  <meta name="description" content="Discover amazing products from verified affiliates worldwide. Browse categories, compare prices, and find the best deals in our global marketplace.">
  <meta name="keywords" content="affiliate marketplace, global products, online shopping, best deals, affiliate network">
  <link rel="canonical" href="https://smartdealsproamazon.github.io/smart.deals.pro/marketplace.html">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="favicon-192x192.png">
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#3b82f6">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Global Marketplace - SmartDeals Pro">
  <meta property="og:description" content="Discover amazing products from verified affiliates worldwide.">
  <meta property="og:image" content="https://smartdealsproamazon.github.io/smart.deals.pro/logo.png">
  <meta property="og:url" content="https://smartdealsproamazon.github.io/smart.deals.pro/marketplace.html">
  <meta property="og:type" content="website">
  
  <!-- Fonts and Styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  
  <style>
    /* Marketplace Specific Styles */
    .marketplace-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6rem 0 4rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      min-height: 60vh;
      display: flex;
      align-items: center;
    }
    
    .marketplace-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 0%, transparent 70%);
    }
    
    .marketplace-hero .container {
      position: relative;
      z-index: 1;
      width: 100%;
    }
    
    .marketplace-hero h1 {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      line-height: 1.2;
    }
    
    .marketplace-hero p {
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto 2rem;
      line-height: 1.6;
    }
    
    .marketplace-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin-top: 3rem;
      flex-wrap: wrap;
    }
    
    .stat-item {
      text-align: center;
      min-width: 120px;
    }
    
    .stat-number {
      display: block;
      font-size: 2.5rem;
      font-weight: 700;
      color: #FFD700;
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    

    
    .products-section {
      padding: 3rem 0;
      min-height: 400px;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .product-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .product-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #f3f4f6;
    }
    
    .product-info {
      padding: 1.5rem;
    }
    
    .product-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .product-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: #059669;
      margin-bottom: 0.5rem;
    }
    
    .product-badges {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .badge.platform {
      background: #dbeafe;
      color: #1d4ed8;
    }
    
    .badge.category {
      background: #f3e8ff;
      color: #7c3aed;
    }
    
    .badge.discount {
      background: #fef3c7;
      color: #d97706;
    }
    
    .product-description {
      color: #6b7280;
      font-size: 0.875rem;
      line-height: 1.5;
      margin-bottom: 1rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .product-cta {
      width: 100%;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .product-cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #6b7280;
    }
    
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      color: #9ca3af;
    }
    
    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #374151;
    }
    
    .load-more-btn {
      display: block;
      margin: 3rem auto 0;
      padding: 1rem 2rem;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .load-more-btn:hover {
      background: #5a67d8;
    }
    
    .load-more-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    
    @media (max-width: 768px) {
      .marketplace-hero {
        padding: 4rem 0 3rem;
        min-height: 50vh;
      }
      
      .marketplace-hero h1 {
        font-size: 2.5rem;
      }
      
      .marketplace-hero p {
        font-size: 1rem;
        padding: 0 1rem;
      }
      
      .marketplace-stats {
        gap: 2rem;
        margin-top: 2rem;
      }
      
      .stat-item {
        min-width: 100px;
      }
      
      .stat-number {
        font-size: 2rem;
      }
      
      .stat-label {
        font-size: 0.8rem;
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .marketplace-hero h1 {
        font-size: 2rem;
      }
      
      .marketplace-stats {
        flex-direction: column;
        gap: 1.5rem;
        align-items: center;
      }
      
      .stat-item {
        min-width: 80px;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; z-index: 10000;">
    <div style="text-align: center;">
      <div style="width: 50px; height: 50px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
      <p style="color: #667eea; font-weight: 500;">Loading Products from Firebase...</p>
    </div>
  </div>

  <!-- Header -->
  <header class="main-header">
    <div class="container">
      <div class="header-content">
        <div class="header-left">
          <div class="logo-link">
            <a href="index.html" class="site-name">
              <img src="logo.svg" alt="SmartDeals Pro" class="logo">
              <span class="logo-text">SmartDeals Pro</span>
            </a>
          </div>
        </div>
        
        <nav class="main-nav">
          <ul>
            <li><a href="index.html" class="nav-link">üè† Home</a></li>
            <li><a href="marketplace.html" class="nav-link active">üõçÔ∏è Marketplace</a></li>
            <li><a href="deals.html" class="nav-link">üí∞ Deals</a></li>
            <li><a href="for-affiliates.html" class="nav-link">üë• For Affiliates</a></li>
            <li><a href="about.html" class="nav-link">‚ÑπÔ∏è About</a></li>
            <li><a href="contact.html" class="nav-link">üìû Contact</a></li>
          </ul>
        </nav>
        
        <div class="header-right">
          <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-content">
      <a href="index.html" class="mobile-nav-link">üè† Home</a>
      <a href="marketplace.html" class="mobile-nav-link active">üõçÔ∏è Marketplace</a>
      <a href="deals.html" class="mobile-nav-link">üí∞ Deals</a>
      <a href="for-affiliates.html" class="mobile-nav-link">üë• For Affiliates</a>
      <a href="about.html" class="mobile-nav-link">‚ÑπÔ∏è About</a>
      <a href="contact.html" class="mobile-nav-link">üìû Contact</a>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="marketplace-hero">
    <div class="container">
      <h1>Global Marketplace</h1>
      <p>Discover thousands of amazing products from verified affiliates around the world. Find the best deals, compare prices, and shop with confidence.</p>
      
      <div class="marketplace-stats">
        <div class="stat-item">
          <span class="stat-number" id="totalProducts">0</span>
          <span class="stat-label">Products</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalAffiliates">0</span>
          <span class="stat-label">Affiliates</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalCategories">0</span>
          <span class="stat-label">Categories</span>
        </div>
      </div>
    </div>
  </section>



  <!-- Products Section -->
  <section class="products-section">
    <div class="container">
      <div class="section-header">
        <h2>Featured Products</h2>
        <p>Discover the best products from our trusted affiliate partners</p>
      </div>
      
      <div id="productsGrid" class="products-grid">
        <!-- Products will be loaded here -->
      </div>
      
      <div id="emptyState" class="empty-state" style="display: none;">
        <i class="fas fa-shopping-cart"></i>
        <h3>No Products Found</h3>
        <p>We're currently updating our product catalog. Please check back soon!</p>
      </div>
      
      <button id="loadMoreBtn" class="load-more-btn" style="display: none;">
        Load More Products
      </button>
    </div>
  </section>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <p>Your trusted global affiliate marketplace connecting shoppers with the best deals worldwide.</p>
        </div>
        
        <div class="footer-section">
          <h4>Shop</h4>
          <ul>
            <li><a href="marketplace.html">Browse Products</a></li>
            <li><a href="deals.html">Special Deals</a></li>
            <li><a href="fashion.html">Fashion</a></li>
            <li><a href="girls-fashion.html">Girls Fashion</a></li>
            <li><a href="boys-fashion.html">Boys Fashion</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>For Affiliates</h4>
          <ul>
            <li><a href="for-affiliates.html">Join Network</a></li>
            <li><a href="affiliate-register.html">Register</a></li>
            <li><a href="affiliate-dashboard.html">Dashboard</a></li>
            <li><a href="success-stories.html">Success Stories</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Support</h4>
          <ul>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="contact.html">Contact Us</a></li>
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="terms.html">Terms of Service</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 SmartDeals Pro. All rights reserved.</p>
        <p class="affiliate-disclaimer">This site contains affiliate links. We may earn a commission when you purchase through links on our site.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- JavaScript -->
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBJqBEWDdBlfv5xAjgcvqput1KC1NzKvlU",
      authDomain: "smart-deals-pro.firebaseapp.com",
      projectId: "smart-deals-pro",
      storageBucket: "smart-deals-pro.firebasestorage.app",
      messagingSenderId: "680016915696",
      appId: "1:680016915696:web:1234567890abcdef"
    };

    // Initialize Firebase
    let db = null;
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      db = firebase.firestore();
      console.log("Firebase initialized successfully for marketplace");
    } catch (error) {
      console.error("Firebase initialization failed:", error);
    }

    // Sample product data - In real implementation, this would come from Firebase/API
    const sampleProducts = [
      {
        id: 1,
        name: "Wireless Bluetooth Headphones",
        price: "$79.99",
        originalPrice: "$129.99",
        image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=300&fit=crop",
        category: "electronics",
        platform: "amazon",
        rating: 4.8,
        description: "Premium wireless headphones with noise cancellation and 30-hour battery life.",
        link: "https://example.com/product1"
      },
      {
        id: 2,
        name: "Smart Fitness Watch",
        price: "$199.99",
        originalPrice: "$299.99",
        image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&h=300&fit=crop",
        category: "electronics",
        platform: "amazon",
        rating: 4.7,
        description: "Track your fitness goals with this advanced smartwatch featuring heart rate monitoring.",
        link: "https://example.com/product2"
      },
      {
        id: 3,
        name: "Organic Cotton T-Shirt",
        price: "$24.99",
        originalPrice: "$39.99",
        image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=300&fit=crop",
        category: "fashion",
        platform: "etsy",
        rating: 4.9,
        description: "Comfortable and sustainable organic cotton t-shirt in various colors.",
        link: "https://example.com/product3"
      },
      {
        id: 4,
        name: "Professional Coffee Maker",
        price: "$149.99",
        originalPrice: "$199.99",
        image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400&h=300&fit=crop",
        category: "home-garden",
        platform: "amazon",
        rating: 4.6,
        description: "Brew cafe-quality coffee at home with programmable settings and thermal carafe.",
        link: "https://example.com/product4"
      },
      {
        id: 5,
        name: "Yoga Mat Premium",
        price: "$34.99",
        originalPrice: "$49.99",
        image: "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400&h=300&fit=crop",
        category: "sports",
        platform: "amazon",
        rating: 4.8,
        description: "Non-slip yoga mat with extra cushioning for comfortable practice.",
        link: "https://example.com/product5"
      },
      {
        id: 6,
        name: "Skincare Set Deluxe",
        price: "$89.99",
        originalPrice: "$129.99",
        image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=400&h=300&fit=crop",
        category: "beauty",
        platform: "amazon",
        rating: 4.7,
        description: "Complete skincare routine with cleanser, serum, and moisturizer.",
        link: "https://example.com/product6"
      }
    ];

    let allProducts = [...sampleProducts];
    let currentPage = 1;
    const productsPerPage = 12;

    // Initialize marketplace when page loads
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('Marketplace page loaded');
      showLoadingScreen();
      
      setupEventListeners();
      
      // Load products from Firebase
      try {
        allProducts = await loadProductsFromSources();
        console.log('Marketplace products loaded:', allProducts.length);
        
        // Update the global variables
        window.marketplaceProducts = allProducts;
        
        // Update stats and render products
        updateStats();
        renderProducts();
        
        // If no products, show helpful message
        if (allProducts.length === 0) {
          const container = document.getElementById('productsGrid'); // Changed from productsContainer to productsGrid
          if (container) {
            container.innerHTML = `
              <div style="text-align: center; padding: 3rem; grid-column: 1 / -1;">
                <i class="fas fa-box-open" style="font-size: 3rem; color: #9ca3af; margin-bottom: 1rem;"></i>
                <h3>No Products Available</h3>
                <p style="margin-bottom: 1rem;">We're currently loading products from our global network.</p>
                <button onclick="location.reload()" class="btn btn-primary">Refresh Page</button>
              </div>
            `;
          }
        }
        
      } catch (error) {
        console.error('Error loading marketplace products:', error);
        
        // Show error state
        const container = document.getElementById('productsGrid'); // Changed from productsContainer to productsGrid
        if (container) {
          container.innerHTML = `
            <div style="text-align: center; padding: 3rem; grid-column: 1 / -1;">
              <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f59e0b; margin-bottom: 1rem;"></i>
              <h3>Loading Error</h3>
              <p style="margin-bottom: 1rem;">Unable to load products. Please check your connection.</p>
              <button onclick="location.reload()" class="btn btn-primary">Try Again</button>
            </div>
          `;
        }
      }
      
      hideLoadingScreen();
    });

    function initializeMarketplace() {
      // Marketplace initialization - products will be loaded separately
      console.log('Marketplace initialized');
    }

    function setupEventListeners() {
      // Load more button
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', loadMoreProducts);
      }

      // Mobile navigation
      setupMobileNavigation();
    }

    function setupMobileNavigation() {
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const mobileMenu = document.getElementById('mobileMenu');

      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', () => {
          mobileMenu.classList.toggle('active');
        });
      }

      // Close mobile menu when clicking outside
      document.addEventListener('click', (e) => {
        if (mobileMenu && mobileMenu.classList.contains('active') && 
            !mobileMenu.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
          mobileMenu.classList.remove('active');
        }
      });
    }



    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const emptyState = document.getElementById('emptyState');
      const loadMoreBtn = document.getElementById('loadMoreBtn');

      if (!grid) return;

      const startIndex = 0;
      const endIndex = currentPage * productsPerPage;
      const productsToShow = allProducts.slice(startIndex, endIndex);

      if (productsToShow.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        loadMoreBtn.style.display = 'none';
        return;
      }

      grid.style.display = 'grid';
      emptyState.style.display = 'none';
      
      grid.innerHTML = '';
      productsToShow.forEach(product => {
        const productCard = createProductCard(product);
        grid.appendChild(productCard);
      });

      // Show/hide load more button
      if (endIndex < allProducts.length) {
        loadMoreBtn.style.display = 'block';
      } else {
        loadMoreBtn.style.display = 'none';
      }
    }

    // Simple formatting functions
    function formatCategoryName(category) {
      return category.split('-').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
    }

    function formatPlatformName(platform) {
      const platformNames = {
        'amazon': 'Amazon',
        'ebay': 'eBay',
        'etsy': 'Etsy',
        'clickbank': 'ClickBank',
        'shareasale': 'ShareASale'
      };
      return platformNames[platform] || platform.charAt(0).toUpperCase() + platform.slice(1);
    }

    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = 'product-card';
      
      const badges = [];
      if (product.platform) {
        badges.push(`<span class="badge platform">${formatPlatformName(product.platform)}</span>`);
      }
      if (product.category) {
        badges.push(`<span class="badge category">${formatCategoryName(product.category)}</span>`);
      }
      if (product.originalPrice && product.originalPrice !== product.price) {
        const discount = Math.round((1 - parseFloat(product.price.replace('$', '')) / parseFloat(product.originalPrice.replace('$', ''))) * 100);
        badges.push(`<span class="badge discount">${discount}% OFF</span>`);
      }

      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
        <div class="product-info">
          <h3 class="product-title">${product.name}</h3>
          <div class="product-price">
            ${product.price}
            ${product.originalPrice && product.originalPrice !== product.price ? 
              `<span style="text-decoration: line-through; color: #9ca3af; font-size: 0.9rem; margin-left: 0.5rem;">${product.originalPrice}</span>` : ''}
          </div>
          ${badges.length > 0 ? `<div class="product-badges">${badges.join('')}</div>` : ''}
          <p class="product-description">${product.description}</p>
          <button class="product-cta" onclick="event.stopPropagation(); handleProductClick('${product.id}', '${product.name}', '${product.link}')">
            <i class="fas fa-shopping-cart"></i> View Product
          </button>
        </div>
      `;

      // Make card clickable
      card.addEventListener('click', (e) => {
        if (!e.target.closest('button')) {
          handleProductClick(product.id, product.name, product.link);
        }
      });

      return card;
    }

    function handleProductClick(productId, productName, productLink) {
      // Track the click
      console.log('Product clicked:', productName);
      
      // In real implementation, track analytics here
      
      // Redirect to product detail or external link
      if (productLink && productLink.startsWith('http')) {
        window.open(productLink, '_blank');
      } else {
        // Navigate to product detail page
        window.location.href = `product-detail.html?id=${productId}`;
      }
    }

    function loadMoreProducts() {
      currentPage++;
      renderProducts();
    }

    function updateStats() {
      const totalProducts = document.getElementById('totalProducts');
      const totalAffiliates = document.getElementById('totalAffiliates');
      const totalCategories = document.getElementById('totalCategories');

      if (totalProducts) {
        animateNumber(totalProducts, allProducts.length);
      }
      
      if (totalAffiliates) {
        const uniqueAffiliates = new Set(allProducts.map(p => p.platform)).size;
        animateNumber(totalAffiliates, uniqueAffiliates * 150); // Simulate affiliate count
      }
      
      if (totalCategories) {
        const uniqueCategories = new Set(allProducts.map(p => p.category)).size;
        animateNumber(totalCategories, uniqueCategories);
      }
    }

    function animateNumber(element, target) {
      let current = 0;
      const increment = target / 30;
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        element.textContent = Math.floor(current).toLocaleString();
      }, 50);
    }

    async function loadProductsFromSources() {
      console.log('Loading products from multiple sources...');
      let allProducts = [];
      
      try {
        // Method 1: Try to get products from window.products (main products system)
        if (window.products && window.products.length > 0) {
          console.log('Found products from main system:', window.products.length);
          allProducts = [...window.products];
        }
        
        // Method 2: Try to get from localStorage cache
        const cachedProducts = JSON.parse(localStorage.getItem('products') || '[]');
        if (cachedProducts.length > 0) {
          console.log('Found cached products:', cachedProducts.length);
          const existingIds = allProducts.map(p => p.id);
          const newProducts = cachedProducts.filter(p => !existingIds.includes(p.id));
          allProducts = [...allProducts, ...newProducts];
        }
        
        // Method 3: Try to load from Firebase directly with timeout
        if (db && allProducts.length === 0) {
          console.log('Attempting direct Firebase load...');
          
          // Use Promise.race for timeout
          const firebasePromise = db.collection('products')
            .orderBy('createdAt', 'desc')
            .limit(50)
            .get();
            
          const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('Firebase timeout')), 8000)
          );
          
          try {
            const snapshot = await Promise.race([firebasePromise, timeoutPromise]);
            const firebaseProducts = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            
            if (firebaseProducts.length > 0) {
              console.log('Loaded products from Firebase:', firebaseProducts.length);
              allProducts = [...allProducts, ...firebaseProducts];
            }
          } catch (firebaseError) {
            console.warn('Firebase direct load failed:', firebaseError.message);
          }
        }
        
        // Method 4: Try to load from render.js if available
        if (window.loadProducts && typeof window.loadProducts === 'function' && allProducts.length === 0) {
          try {
            console.log('Trying to load from render.js...');
            const products = await window.loadProducts();
            if (products && products.length > 0) {
              console.log('Loaded products from render.js:', products.length);
              allProducts = [...allProducts, ...products];
            }
          } catch (renderError) {
            console.warn('Render.js load failed:', renderError.message);
          }
        }
        
        // Fallback: Load sample products if nothing else works
        if (allProducts.length === 0) {
          console.log('Loading fallback sample products...');
          allProducts = sampleProducts;
        }
        
        // Remove duplicates based on ID
        const uniqueProducts = [];
        const seenIds = new Set();
        
        for (const product of allProducts) {
          if (product.id && !seenIds.has(product.id)) {
            seenIds.add(product.id);
            uniqueProducts.push(product);
          }
        }
        
        console.log(`Final product count: ${uniqueProducts.length}`);
        return uniqueProducts;
        
      } catch (error) {
        console.error('Error loading products from all sources:', error);
        console.log('Falling back to sample products only');
        return sampleProducts;
      }
    }

    // Function to save a product to Firebase (for future use)
    async function saveProductToFirebase(productData) {
      if (!db) {
        console.error('Firebase not initialized');
        return false;
      }
      
      try {
        const docRef = await db.collection('products').add({
          ...productData,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Product saved to Firebase with ID:', docRef.id);
        return docRef.id;
      } catch (error) {
        console.error('Error saving product to Firebase:', error);
        return false;
      }
    }

    // Function to update product in Firebase
    async function updateProductInFirebase(productId, updateData) {
      if (!db) {
        console.error('Firebase not initialized');
        return false;
      }
      
      try {
        await db.collection('products').doc(productId).update({
          ...updateData,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Product updated in Firebase:', productId);
        return true;
      } catch (error) {
        console.error('Error updating product in Firebase:', error);
        return false;
      }
    }

    function showLoadingScreen() {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.style.display = 'flex';
      }
    }

    function hideLoadingScreen() {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 500);
        }, 1000);
      }
    }



    // Add CSS animation for loading spinner
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
  </script>

  <!-- External Scripts -->
  <script src="demo-cleanup.js"></script>
  <script src="restore-products.js"></script>
  <script src="products.js"></script>
  <script src="render.js"></script>
  <script src="user-auth.js"></script>
  <script src="scroll-restoration.js"></script>
</body>
</html>