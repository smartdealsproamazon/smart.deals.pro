<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products Verification Test - SmartDeals Pro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .success { background-color: #d4edda; color: #155724; }
    .warning { background-color: #fff3cd; color: #856404; }
    .error { background-color: #f8d7da; color: #721c24; }
    .info { background-color: #d1ecf1; color: #0c5460; }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: white;
    }
    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 4px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Products Verification Test</h1>
    <p>This page tests if products are loading correctly across all systems.</p>
    
    <div id="status" class="status info">Initializing product verification...</div>
    
    <div>
      <button onclick="testProducts()">üîÑ Test Product Loading</button>
      <button onclick="testHomepage()">üè† Test Homepage</button>
      <button onclick="testCategoryPages()">üìÇ Test Categories</button>
      <button onclick="testUSAFlashSale()">üá∫üá∏ Test USA Flash Sale</button>
      <button onclick="clearCache()">üóëÔ∏è Clear Cache</button>
    </div>
    
    <div class="container">
      <h2>Product Load Status</h2>
      <div id="loadStatus">Waiting for test...</div>
    </div>
    
    <div class="container">
      <h2>Sample Products Preview</h2>
      <div id="productsPreview" class="products-grid">
        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
          Click "Test Product Loading" to see products
        </div>
      </div>
    </div>
  </div>

  <!-- Load product system -->
  <script src="products.js"></script>
  <script src="render.js"></script>
  
  <script>
    let testStartTime = Date.now();
    
    function updateStatus(message, type = 'info') {
      const statusEl = document.getElementById('status');
      statusEl.className = `status ${type}`;
      statusEl.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
    }
    
    function updateLoadStatus(html) {
      document.getElementById('loadStatus').innerHTML = html;
    }
    
    function testProducts() {
      testStartTime = Date.now();
      updateStatus('Starting comprehensive product test...', 'info');
      
      const tests = {
        'Window Products Array': !!window.products && window.products.length > 0,
        'Product State Manager': !!window.productStateManager,
        'Products.js Loaded': typeof addInitialDemoProducts === 'function',
        'Render.js Loaded': typeof renderProducts === 'function',
        'Featured Products Function': typeof renderFeaturedProducts === 'function',
        'USA Flash Sale Function': typeof renderUSAFlashSaleProducts === 'function',
        'Local Storage Products': JSON.parse(localStorage.getItem('products') || '[]').length > 0
      };
      
      let html = '<ul>';
      let allPassed = true;
      
      for (const [test, passed] of Object.entries(tests)) {
        const icon = passed ? '‚úÖ' : '‚ùå';
        html += `<li>${icon} ${test}: ${passed ? 'PASS' : 'FAIL'}</li>`;
        if (!passed) allPassed = false;
      }
      
      html += '</ul>';
      
      if (window.products && window.products.length > 0) {
        html += `<h3>üìä Product Statistics</h3>`;
        html += `<ul>`;
        html += `<li><strong>Total Products:</strong> ${window.products.length}</li>`;
        
        const categories = {};
        window.products.forEach(p => {
          const cat = p.category || 'uncategorized';
          categories[cat] = (categories[cat] || 0) + 1;
        });
        
        html += `<li><strong>Categories:</strong></li>`;
        html += `<ul>`;
        for (const [cat, count] of Object.entries(categories)) {
          html += `<li>${cat}: ${count} products</li>`;
        }
        html += `</ul>`;
        html += `</ul>`;
        
        // Show sample products
        displaySampleProducts();
      }
      
      updateLoadStatus(html);
      
      const timeElapsed = Date.now() - testStartTime;
      updateStatus(`Product test completed in ${timeElapsed}ms. Overall: ${allPassed ? 'PASS' : 'FAIL'}`, allPassed ? 'success' : 'error');
    }
    
    function displaySampleProducts() {
      const container = document.getElementById('productsPreview');
      const products = window.products.slice(0, 6); // Show first 6 products
      
      if (products.length === 0) {
        container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #f00;">No products found!</div>';
        return;
      }
      
      container.innerHTML = products.map(product => `
        <div class="product-card">
          <img src="${product.image}" alt="${product.name}" class="product-image" 
               onerror="this.src='https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300&h=300&fit=crop&auto=format&q=80'">
          <h3 style="margin: 10px 0; font-size: 14px;">${product.name}</h3>
          <p style="margin: 5px 0; color: #666; font-size: 12px;">${product.category || 'No category'}</p>
          <p style="margin: 5px 0; font-weight: bold; color: #007bff;">$${product.price}</p>
          ${product.discount ? `<p style="margin: 5px 0; color: #28a745; font-size: 12px;">${product.discount}% OFF</p>` : ''}
        </div>
      `).join('');
    }
    
    function testHomepage() {
      updateStatus('Testing homepage featured products...', 'info');
      
      if (typeof renderFeaturedProducts === 'function') {
        try {
          // Create temporary container
          const tempContainer = document.createElement('div');
          tempContainer.id = 'featuredProductsGrid';
          document.body.appendChild(tempContainer);
          
          renderFeaturedProducts();
          
          const hasProducts = tempContainer.children.length > 0;
          document.body.removeChild(tempContainer);
          
          updateStatus(`Homepage test: ${hasProducts ? 'Products rendered successfully' : 'No products rendered'}`, hasProducts ? 'success' : 'warning');
        } catch (error) {
          updateStatus(`Homepage test failed: ${error.message}`, 'error');
        }
      } else {
        updateStatus('Homepage test failed: renderFeaturedProducts function not found', 'error');
      }
    }
    
    function testCategoryPages() {
      updateStatus('Testing category page filtering...', 'info');
      
      const categories = ['boys-fashion', 'girls-fashion', 'gaming', 'electronics', 'home-garden'];
      let results = '<h3>Category Test Results:</h3><ul>';
      
      categories.forEach(category => {
        if (window.products) {
          const categoryProducts = window.products.filter(p => 
            p.category === category || 
            p.category?.includes(category.split('-')[0]) ||
            p.tags?.some(tag => tag.includes(category.split('-')[0]))
          );
          const icon = categoryProducts.length > 0 ? '‚úÖ' : '‚ö†Ô∏è';
          results += `<li>${icon} ${category}: ${categoryProducts.length} products</li>`;
        }
      });
      
      results += '</ul>';
      updateLoadStatus(results);
      updateStatus('Category page test completed', 'success');
    }
    
    function testUSAFlashSale() {
      updateStatus('Testing USA Flash Sale page...', 'info');
      
      if (typeof renderUSAFlashSaleProducts === 'function') {
        try {
          // Create temporary container
          const tempContainer = document.createElement('div');
          tempContainer.id = 'usaProductsGrid';
          document.body.appendChild(tempContainer);
          
          renderUSAFlashSaleProducts();
          
          const hasProducts = tempContainer.children.length > 0;
          document.body.removeChild(tempContainer);
          
          // Count USA flash sale products
          const usaProducts = window.products?.filter(p => p.category === 'usa-flash-sale').length || 0;
          
          updateStatus(`USA Flash Sale test: ${hasProducts ? 'Products rendered successfully' : 'No products rendered'} (${usaProducts} specific USA products found)`, hasProducts ? 'success' : 'warning');
        } catch (error) {
          updateStatus(`USA Flash Sale test failed: ${error.message}`, 'error');
        }
      } else {
        updateStatus('USA Flash Sale test failed: renderUSAFlashSaleProducts function not found', 'error');
      }
    }
    
    function clearCache() {
      localStorage.removeItem('products');
      localStorage.removeItem('allProducts');
      localStorage.removeItem('products_updated');
      updateStatus('Cache cleared. Refresh the page to reload products.', 'warning');
    }
    
    // Auto-run basic test when page loads
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        updateStatus('Page loaded. Running initial product check...', 'info');
        testProducts();
      }, 1000);
    });
    
    // Listen for product events
    document.addEventListener('products-ready', function() {
      updateStatus('Products ready event received!', 'success');
      testProducts();
    });
  </script>
</body>
</html>